MODULE Test;
IMPORT CR := Coroutines, Out := Out_sys;


VAR
	c1: CR.Context;
	d1: CR.Userdata;
	r: INTEGER;
	stack: ARRAY 4096 OF BYTE;


PROCEDURE Calc(ctx: CR.Context; r: INTEGER): INTEGER;
BEGIN
	Out.String("calculating... "); Out.Int(r, 0); 
	r := CR.Yield(ctx, r);
	Out.String(" done."); Out.Ln;
	RETURN 10
END Calc;


BEGIN
	NEW(d1);
	c1 := CR.Create(Calc, stack, d1);
	r := CR.Yield(c1, r);
	r := CR.Yield(c1, r);
	Out.String("hello"); Out.Ln;
END Test.
